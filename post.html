<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¸–å­è¯¦æƒ…</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        const postId = new URLSearchParams(location.search).get('id');
        
        const { data: post } = await supabase
            .from('posts')
            .select('*')
            .eq('id', postId)
            .single();

        const detailContainer = document.getElementById('postDetail');
        if (!post) {
            detailContainer.innerHTML = '<p>å¸–å­æœªæ‰¾åˆ°</p>';
            return;
        }

        // æ„å»ºè¯¦æƒ…å†…å®¹
        let htmlContent = `
            <h2>${post.title}</h2>
            <div class="post-meta-grid">
                <div><strong>ç‰ˆæœ¬ï¼š</strong>${post.version}</div>
                ${post.loader ? `<div><strong>åŠ è½½å™¨ï¼š</strong>${post.loader}</div>` : ''}
                <div><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>${post.created_at}</div>
                <div><strong>æ¸¸æˆç±»å‹ï¼š</strong>${post.game_type}</div>
                <div><strong>è”æœºç±»å‹ï¼š</strong>${post.server_type}</div>
                <div><strong>è”æœºæ–¹å¼ï¼š</strong>${post.connection_type}</div>
                <div><strong>å­˜æ¡£ç±»å‹ï¼š</strong>${post.save_type}</div>
                ${post.retention_time ? `<div><strong>ç•™å­˜æ—¶é—´ï¼š</strong>${formatRetentionTime(post.retention_time)}</div>` : ''}
            </div>
            <div class="post-content-section">
                <h3>è”æœºè¯¦æƒ…ï¼š</h3>
                <div class="content-box">${post.content.replace(/\n/g, '<br>')}</div>
            </div>
        `;

        if (post.playstyles) {
            htmlContent += `
                <div class="playstyle-section">
                    <h3>ç©æ³•æ ‡ç­¾ï¼š</h3>
                    <div class="tag-container">
                        ${post.playstyles.split(', ').map(t => `<span class="tag">${t}</span>`).join('')}
                    </div>
                </div>
            `;
        }

        htmlContent += `
            <div class="contact-section">
                <h3>ğŸ“§ è”ç³»æ–¹å¼ï¼š</h3>
                <div class="contact-box">${post.contact}</div>
            </div>
        `;

        detailContainer.innerHTML = htmlContent;
      });

      // è¾…åŠ©å‡½æ•°ï¼šè½¬æ¢ç•™å­˜æ—¶é—´ä¸ºå¯è¯»æ ¼å¼
      function formatRetentionTime(minutes) {
          const periods = [
              { value: 525600, unit: 'å¹´' },  // 1å¹´
              { value: 43200, unit: 'æœˆ' },    // 1æœˆ
              { value: 10080, unit: 'å‘¨' },    // 7å¤©
              { value: 1440, unit: 'å¤©' }      // 1å¤©
          ];
          
          for (let period of periods) {
              if (minutes >= period.value) {
                  return `${Math.floor(minutes/period.value)}${period.unit}`;
              }
          }
          return `${minutes}åˆ†é’Ÿ`;
      }

      async function submitPost() {
          const title = document.getElementById('title').value;
          const content = document.getElementById('content').value;
          
          // æ›¿æ¢åŸæ¥çš„localStorageä»£ç 
          const { data, error } = await supabase
              .from('posts')
              .insert([{ title, content }])
              .select()

          if (error) {
              console.error('æäº¤å¤±è´¥:', error);
          } else {
              window.location.href = 'browse.html';
          }
      }
    </script>
</head>
<body>
    <div class="container">
        <h1>å¸–å­è¯¦æƒ…</h1>
        <div class="post-container">
            <h2 id="post-title"></h2>
            <div class="post-meta">
                <span id="post-author"></span>
                <span id="post-time"></span>
            </div>
            <div class="post-content" id="post-content"></div>
        </div>
        <button onclick="window.history.back()">è¿”å›</button>
        <button class="report-btn" data-post-id="{{POST_ID}}">ä¸¾æŠ¥</button>
    </div>
</body>
</html> 